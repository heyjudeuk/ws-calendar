<!doctype html>
<html lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Weird Science Band Availability</title>

  <style>
    :root{
      --bg:#0b0f14;
      --card:#121925;
      --muted:#9fb0c3;
      --text:#e6eef7;
      --border:#243246;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:14px;

      /* Colour-blind safe palette (blue / amber) */
      --good:#2b6cb0;
      --bad:#d97706;
      --good2: rgba(43,108,176,.22);
      --bad2: rgba(217,119,6,.28);
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: radial-gradient(1200px 800px at 20% 0%, #132033 0%, var(--bg) 60%);
      color: var(--text);
    }

    header{
      padding:22px 16px 10px;
      max-width:1200px;
      margin:auto;
    }

    h1{ margin:0 0 10px; font-size:22px; }

    .sub{ color:var(--muted); font-size:14px; margin-bottom:14px; }

    .toolbar{
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      align-items:center;
      background:rgba(18,25,37,.65);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:12px;
      box-shadow:var(--shadow);
    }

    label{ font-size:13px; color:var(--muted); }

    select{
      background:#0e1522;
      border:1px solid var(--border);
      color:var(--text);
      border-radius:10px;
      padding:8px 10px;
      font-size:14px;
      min-width:220px;
    }

    .legend{
      display:flex;
      gap:10px;
      align-items:center;
      margin-left:auto;
      flex-wrap:wrap;
    }

    .pill{
      display:flex;
      gap:8px;
      align-items:center;
      border:1px solid var(--border);
      background:#0e1522;
      border-radius:999px;
      padding:6px 10px;
      font-size:12px;
      color:var(--muted);
    }

    .dot{ width:10px; height:10px; border-radius:50%; }
    .dot.good{ background:var(--good); }
    .dot.bad{ background:var(--bad); }

    main{
      max-width:1200px;
      margin:auto;
      padding:10px 16px 28px;
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:14px;
      margin-top:14px;
    }

    @media (max-width:980px){ .grid{ grid-template-columns:repeat(2,1fr); } }
    @media (max-width:640px){ .grid{ grid-template-columns:1fr; } }

    .card{
      background:rgba(18,25,37,.75);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }

    .monthHeader{
      padding:10px 12px;
      border-bottom:1px solid var(--border);
      display:flex;
      justify-content:space-between;
      font-size:14px;
    }

    .cal{ padding:10px; }

    .dow, .days{
      display:grid;
      grid-template-columns:repeat(7,1fr);
      gap:6px;
      text-align:center;
    }

    .dow{
      color:var(--muted);
      font-size:11px;
      margin-bottom:8px;
    }

    .day{
      position:relative;
      min-height:42px;
      border-radius:10px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      gap:2px;
      font-size:13px;
    }

    .day strong{ font-weight:700; }

    .day.good{
      background:var(--good2);
      border:1px solid rgba(43,108,176,.4);
    }

    .day.bad{
      background:var(--bad2);
      border:1px solid rgba(217,119,6,.45);
      background-image:repeating-linear-gradient(
        45deg,
        rgba(0,0,0,.14),
        rgba(0,0,0,.14) 7px,
        transparent 7px,
        transparent 14px
      );
    }

    .day.empty{ background:transparent; }

    .mark{ font-size:12px; }

    .tooltip{
      position:absolute;
      bottom:110%;
      left:50%;
      transform:translateX(-50%);
      background:#07101c;
      border:1px solid var(--border);
      border-radius:10px;
      padding:8px 10px;
      font-size:12px;
      box-shadow:var(--shadow);
      display:none;
      white-space:nowrap;
      text-align:left;
      z-index:10;
    }

    .day.bad:hover .tooltip{ display:block; }

    .tooltip div{
      display:flex;
      gap:6px;
      align-items:center;
    }

    .raw{
      margin-top:18px;
      background:rgba(18,25,37,.75);
      border:1px solid var(--border);
      border-radius:var(--radius);
      overflow:hidden;
    }

    table{
      width:100%;
      border-collapse:collapse;
      font-size:14px;
    }

    th, td{
      padding:10px 12px;
      border-bottom:1px solid rgba(36,50,70,.6);
      text-align:left;
    }

    th{ font-size:12px; color:var(--muted); }

    .chip{
      display:inline-block;
      margin:2px 6px 2px 0;
      padding:2px 8px;
      border-radius:999px;
      border:1px solid var(--border);
      background:#0e1522;
      font-size:12px;
      color:var(--muted);
    }
  </style>
</head>

<body>
<header>
  <h1 id="title">Weird Science Band Availability</h1>
  <p class="sub" id="subtitle">Loading…</p>

  <div class="toolbar">
    <div>
      <label>Show availability for</label><br/>
      <select id="mode"></select>
    </div>

    <div class="legend">
      <div class="pill"><span class="dot good"></span> Available ✔</div>
      <div class="pill"><span class="dot bad"></span> Unavailable ✖</div>
      <div class="pill" id="rulePill"></div>
    </div>
  </div>
</header>

<main>
  <div id="calGrid" class="grid"></div>

  <div class="raw">
    <table>
      <thead>
        <tr>
          <th>Member</th>
          <th>Unavailable dates</th>
        </tr>
      </thead>
      <tbody id="rawBody"></tbody>
    </table>
  </div>
</main>

<script>
(() => {
  const DATA_URL = 'data/availability.json';
  const DOW = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
  const MONTHS = ['January','February','March','April','May','June','July','August','September','October','November','December'];

  const elGrid = document.getElementById('calGrid');
  const elMode = document.getElementById('mode');
  const elRule = document.getElementById('rulePill');
  const elRaw = document.getElementById('rawBody');
  const elTitle = document.getElementById('title');
  const elSubtitle = document.getElementById('subtitle');

  const pad = n => String(n).padStart(2,'0');
  const iso = (y,m,d) => `${y}-${pad(m)}-${pad(d)}`;

  let state = { members:[], byDate:new Map(), year:2026, mode:'__ALL__' };

  fetch(DATA_URL,{cache:'no-store'})
    .then(r=>r.json())
    .then(data=>{
      state.members = data.members;
      elSubtitle.textContent = `Last updated: ${data.generatedUtc}`;
      buildMaps();
      buildMode();
      renderRaw();
      render();
    });

  function buildMaps(){
    const years = new Set();
    state.byDate.clear();

    for(const m of state.members){
      for(const d of m.unavailable){
        years.add(+d.slice(0,4));
        if(!state.byDate.has(d)) state.byDate.set(d,[]);
        state.byDate.get(d).push(m.name);
      }
    }
    state.year = years.size === 1 ? [...years][0] : Math.min(...years);
    elTitle.textContent = `Weird Science Band Availability for ${state.year}`;
  }

  function buildMode(){
    elMode.innerHTML = '<option value="__ALL__">Whole band</option>';
    state.members
      .map(m=>m.name)
      .sort()
      .forEach(n=>{
        const o=document.createElement('option');
        o.value=o.textContent=n;
        elMode.appendChild(o);
      });

    elMode.onchange=()=>{ state.mode=elMode.value; render(); };
  }

  function render(){
    elGrid.innerHTML='';
    elRule.textContent = state.mode==='__ALL__'
      ? '✔ only if nobody is unavailable'
      : `✔ / ✖ for ${state.mode}`;

    for(let m=1;m<=12;m++){
      const card=document.createElement('div');
      card.className='card';
      card.innerHTML=`<div class="monthHeader">${MONTHS[m-1]} ${state.year}</div>`;
      const cal=document.createElement('div');
      cal.className='cal';

      const dow=document.createElement('div');
      dow.className='dow';
      DOW.forEach(d=>dow.innerHTML+=`<div>${d}</div>`);

      const days=document.createElement('div');
      days.className='days';

      const first=new Date(state.year,m-1,1);
      const offset=(first.getDay()+6)%7;
      for(let i=0;i<offset;i++) days.innerHTML+='<div class="day empty"></div>';

      const count=new Date(state.year,m,0).getDate();
      for(let d=1;d<=count;d++){
        const date=iso(state.year,m,d);
        const names=state.byDate.get(date)||[];
        const bad=state.mode==='__ALL__' ? names.length>0 : names.includes(state.mode);

        const cell=document.createElement('div');
        cell.className=`day ${bad?'bad':'good'}`;
        cell.innerHTML=`<strong>${d}</strong><div class="mark">${bad?'✖':'✔'}</div>`;

        if(bad){
          const tt=document.createElement('div');
          tt.className='tooltip';
          names.forEach(n=>{
            const row=document.createElement('div');
            row.textContent=`✖ ${n}`;
            tt.appendChild(row);
          });
          cell.appendChild(tt);
        }
        days.appendChild(cell);
      }

      cal.appendChild(dow);
      cal.appendChild(days);
      card.appendChild(cal);
      elGrid.appendChild(card);
    }
  }

  function renderRaw(){
    elRaw.innerHTML='';
    state.members.forEach(m=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${m.name}</td><td>${
        m.unavailable.map(d=>`<span class="chip">${d}</span>`).join('')
      }</td>`;
      elRaw.appendChild(tr);
    });
  }
})();
</script>
</body>
</html>
